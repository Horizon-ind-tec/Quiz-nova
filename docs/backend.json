{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the QuizNova application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "plan": {
          "type": "string",
          "description": "The user's current subscription plan.",
          "enum": ["free", "premium", "ultimate"],
          "default": "free"
        },
        "paymentStatus": {
          "type": "string",
          "description": "The current status of the user's payment for a plan upgrade.",
          "enum": ["pending", "confirmed"]
        },
        "pendingPlan": {
           "type": "string",
           "description": "The plan the user is currently attempting to purchase.",
           "enum": ["premium", "ultimate"]
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "createdAt",
        "plan"
      ]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz generated by the AI or created by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Quiz entity."
        },
        "name": {
          "type": "string",
          "description": "Name or title of the quiz."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the quiz content."
        },
        "class": {
          "type": "string",
          "description": "The class or grade level that the quiz is intended for."
        },
        "subject": {
          "type": "string",
          "description": "The subject or topic of the quiz."
        },
        "educationalBoard": {
          "type": "string",
          "description": "The educational board or curriculum that the quiz aligns with."
        },
        "difficultyLevel": {
          "type": "string",
          "description": "The difficulty level of the quiz (e.g., easy, medium, hard)."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Quiz)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the quiz was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "class",
        "subject",
        "educationalBoard",
        "difficultyLevel",
        "userId",
        "createdAt"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question within a quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Question entity."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N Question)"
        },
        "text": {
          "type": "string",
          "description": "The text of the question."
        },
        "correctAnswer": {
          "type": "string",
          "description": "The correct answer to the question."
        },
        "incorrectAnswers": {
          "type": "array",
          "description": "Array of incorrect answers for multiple-choice questions.",
          "items": {
            "type": "string"
          }
        },
        "explanation": {
          "type": "string",
          "description": "Explanation for the correct answer."
        }
      },
      "required": [
        "id",
        "quizId",
        "text",
        "correctAnswer",
        "incorrectAnswers",
        "explanation"
      ]
    },
    "QuizResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuizResult",
      "type": "object",
      "description": "Represents the result of a user taking a quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the QuizResult entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N QuizResult)"
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N QuizResult)"
        },
        "score": {
          "type": "number",
          "description": "The user's score on the quiz (e.g., percentage or raw score)."
        },
        "completionTime": {
          "type": "number",
          "description": "The time it took the user to complete the quiz (e.g., in seconds)."
        },
        "completedAt": {
          "type": "string",
          "description": "Timestamp indicating when the quiz was completed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "quizId",
        "score",
        "completionTime",
        "completedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Path-based ownership. Each user can only access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quizzes created by each user. Path-based ownership ensures that only the user who created the quiz can access it.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "quizId",
              "description": "The unique identifier for the quiz."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizzes/{quizId}/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores questions associated with a specific quiz. Path-based ownership continues, restricting access to questions within quizzes owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "quizId",
              "description": "The unique identifier for the quiz."
            },
            {
              "name": "questionId",
              "description": "The unique identifier for the question."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quiz_results/{quizResultId}",
        "definition": {
          "entityName": "QuizResult",
          "schema": {
            "$ref": "#/backend/entities/QuizResult"
          },
          "description": "Stores quiz results for each user. Path-based ownership ensures that only the user can access their own quiz results.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "quizResultId",
              "description": "The unique identifier for the quiz result."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability. It leverages path-based ownership for user-specific data and segregates data based on access requirements.\n\nUsers are stored in a top-level `users` collection. User-generated quizzes, questions, and quiz results are stored in subcollections under each user document, ensuring clear ownership and simplified security rules. This path-based ownership (`/users/{userId}/quizzes/{quizId}`) allows direct enforcement of access control. Each user has direct access to its quizzes and any quizzes created by one user must not be visible to other users.\n\nThis design achieves Authorization Independence by avoiding `get()` calls in security rules. Since quizzes are stored under the user's document, authorization checks can be based solely on the `request.auth.uid` and the document path. Denormalization is not strictly necessary in this scenario since we take advantage of the hierarchical path structure.\n\nThe structure supports the required QAPs because listing quizzes will occur against the subcollection `/users/{userId}/quizzes`. This inherently limits list operations to the resources owned by the authenticated user."
  }
}
