
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the QuizNova application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "createdAt"
      ]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quiz entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Quiz)"
        },
        "class": {
          "type": "string",
          "description": "The class for which the quiz is generated."
        },
        "subject": {
          "type": "string",
          "description": "The subject of the quiz."
        },
        "educationalBoard": {
          "type": "string",
          "description": "The educational board for the quiz."
        },
        "difficultyLevel": {
          "type": "string",
          "description": "The difficulty level of the quiz."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the quiz was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "class",
        "subject",
        "educationalBoard",
        "difficultyLevel",
        "createdAt"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question within a quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the question entity."
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N Question)"
        },
        "questionText": {
          "type": "string",
          "description": "The text of the question."
        },
        "correctAnswer": {
          "type": "string",
          "description": "The correct answer to the question."
        },
        "incorrectAnswers": {
          "type": "array",
          "description": "An array of incorrect answers for the question.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "quizId",
        "questionText",
        "correctAnswer",
        "incorrectAnswers"
      ]
    },
    "QuizResult": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuizResult",
      "type": "object",
      "description": "Represents the result of a user taking a quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quiz result entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N QuizResult)"
        },
        "quizId": {
          "type": "string",
          "description": "Reference to Quiz. (Relationship: Quiz 1:N QuizResult)"
        },
        "score": {
          "type": "number",
          "description": "The score achieved on the quiz."
        },
        "completionTime": {
          "type": "string",
          "description": "The timestamp when the quiz was completed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "quizId",
        "score",
        "completionTime"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Access is restricted to the user themselves. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quizzes created by each user. Access is restricted to the user who created the quiz. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "quizId",
              "description": "The unique identifier of the quiz."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizzes/{quizId}/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores questions associated with a specific quiz for a user. Access is restricted to the user who created the quiz. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "quizId",
              "description": "The unique identifier of the quiz."
            },
            {
              "name": "questionId",
              "description": "The unique identifier of the question."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizResults/{quizResultId}",
        "definition": {
          "entityName": "QuizResult",
          "schema": {
            "$ref": "#/backend/entities/QuizResult"
          },
          "description": "Stores quiz results for each user. Access is restricted to the user. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "quizResultId",
              "description": "The unique identifier of the quiz result."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize for security, scalability, and query performance, adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. User data is stored in a path-based structure under `/users/{userId}` for private data. Quizzes, Questions and QuizResults are also stored under `/users/{userId}` to leverage path-based security. This ensures that only the user can access their own quizzes, questions and results without relying on complex `get()` calls in the security rules, achieving Authorization Independence. Segregation is achieved by storing different data types (Users, Quizzes, Questions, QuizResults) in separate collections, each with its specific security posture.\n\nThe path-based structure `/users/{userId}/quizzes/{quizId}/questions/{questionId}` provides clear ownership and simplifies queries for retrieving quizzes and questions for a specific user. Similarly, quiz results are stored under `/users/{userId}/quizResults/{quizResultId}`, ensuring easy retrieval of a user's quiz history.\n\nThis structure supports the required QAPs by:\n\n*   Enabling secure `list` operations: Rules can easily restrict list access to only the requesting user's data, because access control relies on the request's authenticated `uid` matching the `userId` parameter in the path. Since the structure places all user-specific data under the `/users/{userId}` path, listing operations are inherently scoped to the user.\n\nThis design avoids the use of custom claims (DBAC) and relies solely on `request.auth.uid` for authorization, making the rules simpler and easier to maintain."
  }
}
